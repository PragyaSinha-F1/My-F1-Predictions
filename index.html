<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Paddock 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.cdnfonts.com/css/formula1');
        body { background-color: black; color: white; font-family: 'Formula1 Display', sans-serif; }
        .f1-italic { font-family: 'Formula1 Display', sans-serif; font-weight: 900; }
        .f1-glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .f1-gradient { background: linear-gradient(90deg, #e10600 0%, #ff3b3b 100%); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // UPDATE THESE WITH YOUR ACTUAL SUPABASE KEYS
        const SB_URL = "https://your-project.supabase.co";
        const SB_KEY = "your-anon-key";
        const sb = supabase.createClient(SB_URL, SB_KEY);

        const TEAM_CONFIG = {
            redbull: { name: 'Red Bull', color: '#3671C6' },
            ferrari: { name: 'Ferrari', color: '#F91536' },
            mclaren: { name: 'McLaren', color: '#FF8000' },
            mercedes: { name: 'Mercedes', color: '#6CD3BF' },
            aston: { name: 'Aston Martin', color: '#229971' },
            audi: { name: 'Audi F1', color: '#000000' }, 
            alpine: { name: 'Alpine', color: '#0093CC' },
            haas: { name: 'Haas', color: '#B6BABD' },
            williams: { name: 'Williams', color: '#64C4FF' },
            rb: { name: 'Racing Bulls', color: '#6692FF' },
            andretti: { name: 'Andretti', color: '#FFFFFF' }
        };

        function App() {
            const [view, setView] = useState('landing');
            const [room, setRoom] = useState(null);
            const [participants, setParticipants] = useState([]);
            const [activeUser, setActiveUser] = useState(null);
            const [myRooms, setMyRooms] = useState([]);
            const [inputRoom, setInputRoom] = useState('');
            const [inputUser, setInputUser] = useState('');
            const [inputPred, setInputPred] = useState('');
            const [selectedColor, setSelectedColor] = useState('redbull');

            useEffect(() => {
                const saved = localStorage.getItem('f1_paddock_history');
                if (saved) setMyRooms(JSON.parse(saved));
            }, []);

            const getAccuracy = (p) => {
                if (!p || !p.predictions || p.predictions.length === 0) return 0;
                const correct = p.predictions.filter(x => x.done).length;
                return Math.round((correct / p.predictions.length) * 100);
            };

            const handleCreate = async () => {
                const code = Math.random().toString(36).substring(2, 8).toUpperCase();
                const roomName = inputRoom || "2026 Championship";
                const { data } = await sb.from('f1_rooms').insert([{ code, name: roomName, data: { participants: [] } }]).select();
                if (data) {
                    setRoom(data[0]);
                    const history = [{code, name: roomName, isOwner: true}, ...myRooms];
                    setMyRooms(history);
                    localStorage.setItem('f1_paddock_history', JSON.stringify(history));
                    setView('dashboard');
                }
            };

            const handleJoin = async (targetCode = null) => {
                const code = targetCode || inputRoom.toUpperCase();
                const { data } = await sb.from('f1_rooms').select().eq('code', code).single();
                if (data) {
                    setRoom(data);
                    setParticipants(data.data.participants || []);
                    setView('dashboard');
                }
            };

            const deleteRoom = (e, code) => {
                e.stopPropagation();
                if(confirm("Delete this room?")) {
                    const filtered = myRooms.filter(r => r.code !== code);
                    setMyRooms(filtered);
                    localStorage.setItem('f1_paddock_history', JSON.stringify(filtered));
                }
            };

            const sync = async (newList) => {
                setParticipants(newList);
                await sb.from('f1_rooms').update({ data: { participants: newList } }).eq('code', room.code);
            };

            const addPlayer = () => {
                if (!inputUser) return;
                const newList = [...participants, { id: Date.now(), name: inputUser, color: selectedColor, predictions: [] }];
                sync(newList);
                setInputUser('');
            };

            if (view === 'landing') return (
                <div className="flex flex-col items-center justify-center min-h-screen p-6">
                    <h1 className="text-5xl font-black italic mb-12">F1<span className="text-[#e10600]">PADDOCK</span></h1>
                    <div className="f1-glass p-8 rounded-3xl w-full max-w-sm mb-6">
                        <input className="w-full bg-black border border-zinc-800 p-4 rounded-xl mb-4 text-center uppercase font-bold" placeholder="ROOM CODE" value={inputRoom} onChange={e => setInputRoom(e.target.value)} />
                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={handleCreate} className="f1-gradient p-4 rounded-xl font-black uppercase text-xs">Create</button>
                            <button onClick={() => handleJoin()} className="bg-white text-black p-4 rounded-xl font-black uppercase text-xs">Join</button>
                        </div>
                    </div>
                    {myRooms.map(r => (
                        <div key={r.code} className="f1-glass p-4 rounded-xl flex justify-between items-center w-full max-w-sm mb-2 cursor-pointer" onClick={() => handleJoin(r.code)}>
                            <div><p className="text-xs font-bold">{r.name}</p><p className="text-[#e10600] text-[10px]">{r.code}</p></div>
                            <button onClick={(e) => deleteRoom(e, r.code)}>üóëÔ∏è</button>
                        </div>
                    ))}
                </div>
            );

            if (view === 'dashboard') {
                const sorted = [...participants].sort((a, b) => getAccuracy(b) - getAccuracy(a));
                const p1 = sorted[0]; const p2 = sorted[1]; const p3 = sorted[2];
                const tie23 = p2 && p3 && getAccuracy(p2) === getAccuracy(p3) && getAccuracy(p2) !== 0;

                return (
                    <div className="max-w-2xl mx-auto p-6 py-12">
                        <div className="flex justify-between items-center mb-8">
                            <h2 className="text-2xl font-black italic uppercase">{room.name}</h2>
                            <button onClick={() => setView('landing')} className="text-zinc-500 text-[10px] font-bold uppercase">Exit</button>
                        </div>

                        <div className="f1-glass p-8 rounded-[2.5rem] mb-12 text-center relative overflow-hidden">
                            <p className="text-zinc-500 text-[10px] uppercase font-bold tracking-widest mb-10">2026 Live Standings</p>
                            <div className="flex items-end justify-center gap-3 h-48">
                                <div className="flex-1 max-w-[120px]">
                                    <p className="text-[10px] font-bold mb-2 truncate">{tie23 ? `${p2.name} & ${p3.name}` : (p2?.name || '-')}</p>
                                    <div className="rounded-t-lg flex items-center justify-center font-black text-2xl text-black/50 italic"
                                         style={{ height: '90px', background: tie23 ? `repeating-linear-gradient(45deg, ${TEAM_CONFIG[p2.color].color}, ${TEAM_CONFIG[p2.color].color} 10px, ${TEAM_CONFIG[p3.color].color} 10px, ${TEAM_CONFIG[p3.color].color} 20px)` : (p2 ? TEAM_CONFIG[p2.color].color : '#222') }}>
                                        {tie23 ? '=' : '2'}
                                    </div>
                                    <p className="mt-2 text-[10px] font-bold text-zinc-400">{p2 ? getAccuracy(p2) : 0}%</p>
                                </div>
                                <div className="flex-1 max-w-[120px]">
                                    <p className="text-xs font-bold mb-2 truncate">{p1?.name || '-'}</p>
                                    <div className="rounded-t-lg flex items-center justify-center font-black text-4xl text-black/40 italic"
                                         style={{ height: '120px', background: p1 ? TEAM_CONFIG[p1.color].color : '#333', borderTop: '2px solid white' }}>1</div>
                                    <p className="mt-2 text-xs font-bold">{p1 ? getAccuracy(p1) : 0}%</p>
                                </div>
                                {!tie23 && (
                                    <div className="flex-1 max-w-[100px]">
                                        <p className="text-[10px] font-bold mb-2 truncate">{p3?.name || '-'}</p>
                                        <div className="rounded-t-lg flex items-center justify-center font-black text-2xl text-black/50 italic"
                                             style={{ height: '70px', background: p3 ? TEAM_CONFIG[p3.color].color : '#111' }}>3</div>
                                        <p className="mt-2 text-[10px] font-bold text-zinc-400">{p3 ? getAccuracy(p3) : 0}%</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="f1-glass p-8 rounded-3xl mb-12">
                            <input className="w-full bg-black border border-zinc-800 p-4 rounded-xl text-white mb-6" placeholder="Participant Name" value={inputUser} onChange={e => setInputUser(e.target.value)} />
                            <div className="grid grid-cols-2 sm:grid-cols-3 gap-2 mb-6">
                                {Object.entries(TEAM_CONFIG).map(([id, team]) => (
                                    <button key={id} onClick={() => setSelectedColor(id)} className={`flex items-center gap-2 p-2 rounded-lg border text-[10px] font-bold uppercase transition ${selectedColor === id ? 'bg-zinc-800 border-white' : 'border-zinc-900 opacity-50'}`}>
                                        <div className="w-3 h-3 rounded-full" style={{background: team.color}} /> {team.name}
                                    </button>
                                ))}
                            </div>
                            <button onClick={addPlayer} className="w-full f1-gradient p-4 rounded-xl font-black uppercase text-xs">Add Strategist</button>
                        </div>

                        <div className="space-y-3">
                            {participants.map(p => (
                                <div key={p.id} onClick={() => { setActiveUser(p); setView('predictions'); }} className="f1-glass p-6 rounded-2xl flex justify-between items-center cursor-pointer border-l-4 hover:bg-zinc-900/50" style={{borderLeftColor: TEAM_CONFIG[p.color].color}}>
                                    <span className="font-bold uppercase italic">{p.name}</span>
                                    <span className="text-[10px] font-bold text-zinc-500">{getAccuracy(p)}% ACCURACY</span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            if (view === 'predictions') return (
                <div className="max-w-2xl mx-auto p-6 py-12">
                    <button onClick={() => setView('dashboard')} className="text-zinc-500 font-bold text-[10px] uppercase mb-10 block">‚Üê Back</button>
                    <div className="p-8 rounded-3xl mb-12 flex justify-between items-center" style={{background: `linear-gradient(135deg, ${TEAM_CONFIG[activeUser.color].color}44 0%, transparent 100%)`}}>
                        <div><h1 className="text-4xl font-black italic uppercase">{activeUser.name}</h1>
                        <p className="text-[10px] font-bold opacity-60 tracking-[0.2em]">LISTED PREDICTIONS</p></div>
                        <p className="text-3xl font-black italic">{getAccuracy(activeUser)}%</p>
                    </div>
                    <div className="flex gap-2 mb-8">
                        <input className="flex-1 f1-glass p-4 rounded-xl bg-transparent border-zinc-800" placeholder="New prediction..." value={inputPred} onChange={e => setInputPred(e.target.value)} onKeyPress={e => e.key === 'Enter' && (async () => {
                            const updated = participants.map(p => p.id === activeUser.id ? {...p, predictions: [...p.predictions, {id: Date.now(), text: inputPred, done: false}]} : p);
                            await sync(updated); setActiveUser(updated.find(u => u.id === activeUser.id)); setInputPred('');
                        })()} />
                        <button onClick={async () => {
                            const updated = participants.map(p => p.id === activeUser.id ? {...p, predictions: [...p.predictions, {id: Date.now(), text: inputPred, done: false}]} : p);
                            await sync(updated); setActiveUser(updated.find(u => u.id === activeUser.id)); setInputPred('');
                        }} className="f1-gradient px-6 rounded-xl font-black uppercase text-xs">Add</button>
                    </div>
                    <div className="space-y-3">
                        {activeUser.predictions.map(pr => (
                            <div key={pr.id} className="f1-glass p-5 rounded-xl flex items-center justify-between">
                                <div className="flex items-center gap-4 cursor-pointer" onClick={async () => {
                                    const updated = participants.map(p => p.id === activeUser.id ? {...p, predictions: p.predictions.map(x => x.id === pr.id ? {...x, done: !x.done} : x)} : p);
                                    await sync(updated); setActiveUser(updated.find(u => u.id === activeUser.id));
                                }}>
                                    <div className={`w-5 h-5 rounded border ${pr.done ? 'bg-green-500 border-green-500' : 'border-zinc-700'}`}>{pr.done && '‚úì'}</div>
                                    <span className={pr.done ? 'text-zinc-600 line-through' : ''}>{pr.text}</span>
                                </div>
                                <button onClick={async () => {
                                    const updated = participants.map(p => p.id === activeUser.id ? {...p, predictions: p.predictions.filter(x => x.id !== pr.id)} : p);
                                    await sync(updated); setActiveUser(updated.find(u => u.id === activeUser.id));
                                }} className="text-zinc-600">‚úï</button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
