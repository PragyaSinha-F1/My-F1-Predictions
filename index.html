<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Paddock 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        /* Reliable Formula 1 Font Source */
        @font-face {
            font-family: 'Formula1';
            src: url('https://smart-realty.com.ua/fonts/Formula1-Black.woff2') format('woff2');
            font-weight: 900;
        }
        body { background-color: #050505; color: white; font-family: 'Formula1', sans-serif; overflow-x: hidden; }
        .f1-glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .f1-gradient { background: linear-gradient(90deg, #e10600 0%, #ff3b3b 100%); }
        .status-line { height: 4px; width: 100%; position: fixed; top: 0; left: 0; z-index: 100; transition: all 0.5s ease; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const SB_URL = "https://gyzflcxqehesojhimokd.supabase.co"; 
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd5emZsY3hxZWhlc29qaGltb2tkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMzQ4MjcsImV4cCI6MjA4MzcxMDgyN30.fOW7qr9cNEUp6otJU2f-tXtOJxRX4Wge9R76OXE-_Tk";
        const sb = supabase.createClient(SB_URL, SB_KEY);

        const TEAM_CONFIG = {
            redbull: { name: 'Red Bull', color: '#3671C6' }, ferrari: { name: 'Ferrari', color: '#F91536' },
            mclaren: { name: 'McLaren', color: '#FF8000' }, mercedes: { name: 'Mercedes', color: '#6CD3BF' },
            aston: { name: 'Aston Martin', color: '#229971' }, audi: { name: 'Audi F1', color: '#f5f5f5' }, 
            alpine: { name: 'Alpine', color: '#0093CC' }, haas: { name: 'Haas', color: '#B6BABD' },
            williams: { name: 'Williams', color: '#64C4FF' }, rb: { name: 'Racing Bulls', color: '#6692FF' },
            andretti: { name: 'Andretti', color: '#FFFFFF' }
        };

        const NEXT_RACE = { name: "Bahrain Grand Prix", flag: "üáßüá≠", date: new Date("2026-04-12T18:00:00Z") };

        function App() {
            const [view, setView] = useState('landing');
            const [room, setRoom] = useState(null);
            const [participants, setParticipants] = useState([]);
            const [isLocked, setIsLocked] = useState(false);
            const [activeUser, setActiveUser] = useState(null);
            const [timeLeft, setTimeLeft] = useState("");
            const [inputRoom, setInputRoom] = useState('');
            const [inputUser, setInputUser] = useState('');
            const [inputPred, setInputPred] = useState('');
            const [selectedColor, setSelectedColor] = useState('redbull');
            const [myRooms, setMyRooms] = useState([]);

            useEffect(() => {
                const saved = localStorage.getItem('f1_paddock_history');
                if (saved) setMyRooms(JSON.parse(saved));

                const timer = setInterval(() => {
                    const diff = NEXT_RACE.date.getTime() - new Date().getTime();
                    const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
                    const m = Math.floor((diff / (1000 * 60)) % 60);
                    setTimeLeft(`${d}D : ${h}H : ${m}M`);
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            const sync = async (newList, lockState) => {
                setParticipants(newList);
                setIsLocked(lockState);
                await sb.from('f1_rooms').update({ data: { participants: newList, isLocked: lockState } }).eq('code', room.code);
            };

            const handleJoin = async (code) => {
                const { data } = await sb.from('f1_rooms').select().eq('code', code.toUpperCase()).single();
                if (data) {
                    setRoom(data);
                    setParticipants(data.data.participants || []);
                    setIsLocked(data.data.isLocked || false);
                    setView('dashboard');
                    if (!myRooms.find(r => r.code === data.code)) {
                        const newRooms = [...myRooms, {code: data.code, name: data.name}];
                        setMyRooms(newRooms);
                        localStorage.setItem('f1_paddock_history', JSON.stringify(newRooms));
                    }
                }
            };

            const getAccuracy = (p) => {
                if (!p.predictions?.length) return 0;
                return Math.round((p.predictions.filter(x => x.done).length / p.predictions.length) * 100);
            };

            if (view === 'landing') return (
                <div className="flex flex-col items-center justify-center min-h-screen p-6">
                    <h1 className="text-6xl font-black italic tracking-tighter mb-12">F1<span className="text-[#e10600]">PADDOCK</span></h1>
                    <div className="f1-glass p-8 rounded-3xl w-full max-w-sm">
                        <input className="w-full bg-transparent border-b border-zinc-800 p-4 mb-6 text-center text-white outline-none font-bold uppercase" 
                               placeholder="ENTER ROOM CODE" value={inputRoom} onChange={e => setInputRoom(e.target.value)} />
                        <button onClick={() => handleJoin(inputRoom)} className="w-full f1-gradient p-4 rounded-xl font-black uppercase text-sm">Enter Paddock</button>
                    </div>
                    <div className="mt-8 w-full max-w-sm space-y-2">
                        {myRooms.map(r => (
                            <div key={r.code} onClick={() => handleJoin(r.code)} className="f1-glass p-4 rounded-xl flex justify-between items-center cursor-pointer hover:bg-white/5">
                                <span className="text-[10px] font-black uppercase">{r.name}</span>
                                <span className="text-[10px] text-[#e10600]">{r.code}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );

            if (view === 'dashboard') return (
                <div className="max-w-xl mx-auto p-6 pt-16">
                    <div className={`status-line ${isLocked ? 'bg-red-600 shadow-[0_0_15px_#e10600]' : 'bg-green-500 shadow-[0_0_15px_#22c55e]'}`}></div>
                    
                    <div className="f1-glass p-4 rounded-2xl mb-10 flex justify-between items-center border-l-4 border-l-[#e10600]">
                        <div><p className="text-[9px] font-black opacity-40 uppercase">Next Race</p><p className="text-xs font-black uppercase italic">{NEXT_RACE.flag} {NEXT_RACE.name}</p></div>
                        <div className="text-right"><p className="text-[9px] font-black opacity-40 uppercase">Lockdown In</p><p className="text-xs font-black text-[#e10600]">{timeLeft}</p></div>
                    </div>

                    <div className="flex justify-between items-center mb-10">
                        <div><h2 className="text-3xl font-black italic uppercase leading-none">{room.name}</h2>
                        <p className="text-[#e10600] text-[9px] font-black mt-2 tracking-widest uppercase">Room Code: {room.code}</p></div>
                        <button onClick={() => sync(participants, !isLocked)} className={`text-[9px] px-5 py-2 rounded-full font-black uppercase tracking-tighter transition-all ${isLocked ? 'bg-zinc-800 text-green-500' : 'bg-red-600 text-white animate-pulse'}`}>
                            {isLocked ? 'üîì Open Entry' : 'üîí Lock Paddock'}
                        </button>
                    </div>

                    {!isLocked && (
                        <div className="f1-glass p-8 rounded-[2rem] mb-12 border-zinc-900">
                            <input className="w-full bg-black border border-zinc-800 p-4 rounded-xl mb-6 outline-none text-xs font-bold" placeholder="STRATEGIST NAME" value={inputUser} onChange={e => setInputUser(e.target.value)} />
                            <div className="grid grid-cols-6 gap-2 mb-6">
                                {Object.keys(TEAM_CONFIG).map(id => (
                                    <div key={id} onClick={() => setSelectedColor(id)} className={`h-6 rounded cursor-pointer border-2 transition-all ${selectedColor === id ? 'border-white scale-110 shadow-lg' : 'border-transparent opacity-30'}`} style={{backgroundColor: TEAM_CONFIG[id].color}} />
                                ))}
                            </div>
                            <button onClick={() => { if(inputUser) sync([...participants, {id: Date.now(), name: inputUser, color: selectedColor, predictions: []}], isLocked); setInputUser(''); }} className="w-full bg-white text-black font-black p-4 rounded-xl uppercase text-[10px]">Join the Grid</button>
                        </div>
                    )}

                    <div className="space-y-4">
                        {participants.map(p => (
                            <div key={p.id} onClick={() => { setActiveUser(p); setView('predictions'); }} className="f1-glass p-6 rounded-2xl flex justify-between items-center hover:bg-white/5 cursor-pointer border-r-4" style={{borderRightColor: TEAM_CONFIG[p.color].color}}>
                                <div><p className="text-xl font-black italic uppercase leading-none">{p.name}</p><p className="text-[9px] opacity-30 font-black uppercase tracking-widest mt-1">{TEAM_CONFIG[p.color].name}</p></div>
                                <p className="text-2xl font-black italic">{getAccuracy(p)}%</p>
                            </div>
                        ))}
                    </div>
                </div>
            );

            if (view === 'predictions') return (
                <div className="max-w-xl mx-auto p-6 pt-12">
                    <button onClick={() => setView('dashboard')} className="mb-10 text-[9px] font-black opacity-30 hover:opacity-100 transition">‚Üê BACK TO PADDOCK</button>
                    <div className="mb-12 border-l-8 p-6 bg-white/5 rounded-r-2xl" style={{borderColor: TEAM_CONFIG[activeUser.color].color}}>
                        <h1 className="text-5xl font-black italic uppercase leading-tight">{activeUser.name}</h1>
                        <p className="text-[10px] opacity-40 font-black tracking-[0.4em] uppercase mt-2">LISTED PREDICTIONS</p>
                    </div>

                    {!isLocked && (
                        <div className="flex gap-2 mb-10">
                            <input className="flex-1 bg-zinc-900 border border-zinc-800 p-5 rounded-2xl outline-none focus:border-[#e10600] font-bold text-sm" placeholder="TYPE PREDICTION..." value={inputPred} onChange={e => setInputPred(e.target.value)} />
                            <button onClick={() => { if(!inputPred) return; const nl = participants.map(u => u.id === activeUser.id ? {...u, predictions: [...u.predictions, {id: Date.now(), text: inputPred, done: false}]} : u); sync(nl, isLocked); setActiveUser(nl.find(x => x.id === activeUser.id)); setInputPred(''); }} className="f1-gradient px-8 rounded-2xl font-black text-xs uppercase">ADD</button>
                        </div>
                    )}

                    <div className="space-y-3">
                        {activeUser.predictions.map(pr => (
                            <div key={pr.id} className="f1-glass p-6 rounded-2xl flex items-center justify-between group border-zinc-900">
                                <div className="flex items-center gap-6 cursor-pointer flex-1" onClick={() => { const nl = participants.map(u => u.id === activeUser.id ? {...u, predictions: u.predictions.map(x => x.id === pr.id ? {...x, done: !x.done} : x)} : u); sync(nl, isLocked); setActiveUser(nl.find(x => x.id === activeUser.id)); }}>
                                    <div className={`w-6 h-6 rounded flex items-center justify-center border-2 transition-all ${pr.done ? 'bg-green-500 border-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]' : 'border-zinc-700'}`}>
                                        {pr.done && <span className="text-black font-black text-[10px]">‚úì</span>}
                                    </div>
                                    <span className={`text-lg font-black italic uppercase ${pr.done ? 'opacity-20 line-through' : ''}`}>{pr.text}</span>
                                </div>
                                {!isLocked && <button onClick={() => { const nl = participants.map(u => u.id === activeUser.id ? {...u, predictions: u.predictions.filter(x => x.id !== pr.id)} : u); sync(nl, isLocked); setActiveUser(nl.find(x => x.id === activeUser.id)); }} className="opacity-0 group-hover:opacity-100 text-zinc-700 hover:text-red-500 font-bold transition">‚úï</button>}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
