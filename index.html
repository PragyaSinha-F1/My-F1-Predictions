<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Predictions 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @font-face { font-family: 'Formula1'; src: url('https://smart-realty.com.ua/fonts/Formula1-Black.woff2') format('woff2'); font-weight: 900; }
        body { background-color: #0a0a0a; color: #e4e4e7; font-family: 'Inter', sans-serif; }
        .f1-font { font-family: 'Formula1', sans-serif; }
        .f1-glass { background: rgba(18, 18, 18, 0.8); border: 1px solid rgba(255, 255, 255, 0.05); }
        .f1-red { color: #e10600; }
        .f1-bg-red { background-color: #e10600; }
        .progress-ring__circle { transition: stroke-dashoffset 0.8s ease-in-out; transform: rotate(-90deg); transform-origin: 50% 50%; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const SB_URL = "https://gyzflcxqehesojhimokd.supabase.co"; 
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd5emZsY3hxZWhlc29qaGltb2tkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMzQ4MjcsImV4cCI6MjA4MzcxMDgyN30.fOW7qr9cNEUp6otJU2f-tXtOJxRX4Wge9R76OXE-_Tk";
        const sb = supabase.createClient(SB_URL, SB_KEY);

        const TEAMS = {
            redbull: { name: 'Red Bull Ford', color: '#3671C6' }, ferrari: { name: 'Ferrari', color: '#F91536' },
            mclaren: { name: 'McLaren', color: '#FF8000' }, mercedes: { name: 'Mercedes', color: '#6CD3BF' },
            aston: { name: 'Aston Honda', color: '#229971' }, audi: { name: 'Audi F1', color: '#f5f5f5' }, 
            alpine: { name: 'Alpine', color: '#0093CC' }, haas: { name: 'Haas', color: '#B6BABD' },
            williams: { name: 'Williams', color: '#64C4FF' }, rb: { name: 'Racing Bulls', color: '#6692FF' },
            andretti: { name: 'Andretti Cadillac', color: '#FFFFFF' }
        };

        const CALENDAR_2026 = [
            { name: "Australia", date: new Date("2026-03-08") }, { name: "China", date: new Date("2026-03-15") },
            { name: "Japan", date: new Date("2026-03-29") }, { name: "Bahrain", date: new Date("2026-04-12") },
            { name: "Saudi Arabia", date: new Date("2026-04-19") }, { name: "Miami", date: new Date("2026-05-03") },
            { name: "Canada", date: new Date("2026-05-24") }, { name: "Monaco", date: new Date("2026-06-07") },
            { name: "Barcelona", date: new Date("2026-06-14") }, { name: "Austria", date: new Date("2026-06-28") },
            { name: "Great Britain", date: new Date("2026-07-05") }, { name: "Belgium", date: new Date("2026-07-19") },
            { name: "Hungary", date: new Date("2026-07-26") }, { name: "Netherlands", date: new Date("2026-08-23") },
            { name: "Italy", date: new Date("2026-09-06") }, { name: "Madrid", date: new Date("2026-09-13") },
            { name: "Azerbaijan", date: new Date("2026-09-26") }, { name: "Singapore", date: new Date("2026-10-11") },
            { name: "Austin", date: new Date("2026-10-25") }, { name: "Mexico", date: new Date("2026-11-01") },
            { name: "Brazil", date: new Date("2026-11-08") }, { name: "Las Vegas", date: new Date("2026-11-21") },
            { name: "Qatar", date: new Date("2026-11-29") }, { name: "Abu Dhabi", date: new Date("2026-12-06") }
        ];

        function CircularProgress({ value, max }) {
            const radius = 60; const dash = 2 * Math.PI * radius;
            const offset = dash - (value / max) * dash;
            return (
                <div className="relative flex items-center justify-center">
                    <svg width="140" height="140">
                        <circle cx="70" cy="70" r={radius} stroke="#1f1f1f" strokeWidth="10" fill="transparent" />
                        <circle cx="70" cy="70" r={radius} stroke="#e10600" strokeWidth="10" fill="transparent"
                                strokeDasharray={dash} strokeDashoffset={offset} strokeLinecap="round" className="progress-ring__circle" />
                    </svg>
                    <div className="absolute text-center">
                        <span className="block text-3xl font-black f1-font leading-none">{value}</span>
                        <span className="text-[8px] opacity-40 uppercase font-black tracking-widest">of {max} races</span>
                    </div>
                </div>
            );
        }

        function App() {
            const [view, setView] = useState('landing');
            const [room, setRoom] = useState(null);
            const [participants, setParticipants] = useState([]);
            const [isLocked, setIsLocked] = useState(false);
            const [activeUser, setActiveUser] = useState(null);
            const [roomInput, setRoomInput] = useState('');
            const [userName, setUserName] = useState('');
            const [userTeam, setUserTeam] = useState('redbull');
            const [predInput, setPredInput] = useState('');

            const currentRound = CALENDAR_2026.filter(r => r.date < new Date()).length;
            const seasonProgress = Math.round((currentRound / 24) * 100);

            const updateDB = async (newList, lockState) => {
                setParticipants(newList);
                setIsLocked(lockState);
                await sb.from('f1_rooms').update({ data: { participants: newList, isLocked: lockState } }).eq('code', room.code);
            };

            const handleJoin = async (code) => {
                const { data } = await sb.from('f1_rooms').select().eq('code', code.toUpperCase()).single();
                if (data) { setRoom(data); setParticipants(data.data.participants || []); setIsLocked(data.data.isLocked || false); setView('dashboard'); }
            };

            const handleCreate = async () => {
                const code = Math.random().toString(36).substring(2, 8).toUpperCase();
                await sb.from('f1_rooms').insert([{ code, name: roomInput || "2026 Paddock", data: { participants: [], isLocked: false } }]);
                handleJoin(code);
            };

            const getAcc = (p) => {
                if (!p.predictions?.length) return 0;
                return Math.round((p.predictions.filter(x => x.done).length / p.predictions.length) * 100);
            };

            if (view === 'landing') return (
                <div className="flex flex-col items-center justify-center min-h-screen p-6">
                    <div className="flex items-center gap-3 mb-2"><span className="text-3xl">üö©</span><h1 className="text-4xl font-black uppercase tracking-tighter f1-font">F1 <span className="f1-red">PREDICTIONS</span></h1></div>
                    <p className="text-zinc-500 text-sm mb-12">Track your season predictions</p>
                    <div className="f1-glass p-8 rounded-3xl w-full max-w-sm border border-zinc-800 shadow-2xl">
                        <input className="w-full bg-transparent border-b border-zinc-800 p-4 mb-8 text-center outline-none font-bold uppercase text-white" placeholder="ENTER ROOM CODE" value={roomInput} onChange={e => setRoomInput(e.target.value)} />
                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={handleCreate} className="bg-zinc-900 border border-zinc-800 p-4 rounded-xl font-bold uppercase text-[10px]">Create</button>
                            <button onClick={() => handleJoin(roomInput)} className="f1-bg-red p-4 rounded-xl font-black uppercase text-[10px]">Join</button>
                        </div>
                    </div>
                </div>
            );

            if (view === 'dashboard') return (
                <div className="max-w-4xl mx-auto p-6 pt-10">
                    <header className="flex justify-between items-center mb-10">
                        <div className="flex items-center gap-2"><span className="f1-red text-xl font-black f1-font">F1</span><span className="font-black uppercase text-xs tracking-widest">{room.name}</span></div>
                        <div className="flex gap-4">
                            <button onClick={() => setView('landing')} className="text-[10px] font-black opacity-30 hover:opacity-100 transition">Exit</button>
                            <button onClick={() => updateDB(participants, !isLocked)} className={`px-4 py-1.5 rounded-full text-[9px] font-black ${isLocked ? 'bg-zinc-800 text-green-500' : 'bg-red-600 text-white'}`}>{isLocked ? 'üîì UNLOCKED' : 'üîí LOCK GRID'}</button>
                        </div>
                    </header>

                    <div className="f1-glass rounded-[2.5rem] p-8 mb-10 flex flex-col md:flex-row items-center justify-around gap-8">
                        <div className="flex-1 w-full max-w-sm">
                            <h3 className="font-black uppercase text-[10px] tracking-widest opacity-40 mb-4">Season Progress</h3>
                            <div className="h-1.5 bg-zinc-800 rounded-full w-full overflow-hidden">
                                <div className="h-full f1-bg-red" style={{width: `${seasonProgress}%`}}></div>
                            </div>
                            <div className="flex justify-between mt-3 text-[10px] font-black italic">
                                <span>START</span>
                                <span className="f1-red">{seasonProgress}% COMPLETE</span>
                                <span>FINISH</span>
                            </div>
                        </div>
                        <CircularProgress value={currentRound} max={24} />
                    </div>

                    <div className="grid md:grid-cols-3 gap-6">
                        {!isLocked && (
                            <div className="f1-glass p-6 rounded-3xl border-dashed border-zinc-800 flex flex-col justify-center">
                                <input className="bg-zinc-900 border border-zinc-800 p-3 rounded-xl mb-3 text-xs font-bold" placeholder="NAME" value={userName} onChange={e => setUserName(e.target.value)} />
                                <select className="bg-zinc-900 border border-zinc-800 p-3 rounded-xl mb-4 text-xs font-bold appearance-none uppercase" value={userTeam} onChange={e => setUserTeam(e.target.value)}>
                                    {Object.entries(TEAMS).map(([id, t]) => <option key={id} value={id}>{t.name}</option>)}
                                </select>
                                <button onClick={() => { if(userName) updateDB([...participants, {id: Date.now(), name: userName, color: userTeam, predictions: []}], isLocked); setUserName(''); }} className="f1-bg-red p-3 rounded-xl font-black uppercase text-[10px]">Add Strategist</button>
                            </div>
                        )}
                        {participants.map(p => (
                            <div key={p.id} className="f1-glass p-6 rounded-3xl border-l-4 relative group" style={{borderLeftColor: TEAMS[p.color].color}}>
                                <button onClick={() => updateDB(participants.filter(x => x.id !== p.id), isLocked)} className="absolute top-4 right-4 text-zinc-800 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">‚úï</button>
                                <div onClick={() => { setActiveUser(p); setView('predictions'); }} className="cursor-pointer">
                                    <p className="text-[8px] font-black opacity-40 uppercase mb-1">{TEAMS[p.color].name}</p>
                                    <h4 className="text-xl font-black italic uppercase mb-4">{p.name}</h4>
                                    <div className="flex justify-between items-center bg-black/40 p-3 rounded-xl">
                                        <span className="text-[9px] font-bold opacity-30">ACCURACY</span>
                                        <span className="font-black f1-red">{getAcc(p)}%</span>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            if (view === 'predictions') return (
                <div className="max-w-xl mx-auto p-6 pt-12">
                    <button onClick={() => setView('dashboard')} className="mb-10 text-[10px] font-black opacity-30 uppercase">‚Üê Paddock</button>
                    <div className="mb-12 border-l-8 p-6 bg-white/5 rounded-r-3xl" style={{borderColor: TEAMS[activeUser.color].color}}>
                        <h1 className="text-5xl font-black italic uppercase leading-none">{activeUser.name}</h1>
                        <p className="text-[10px] opacity-40 font-black mt-2 tracking-widest uppercase">{TEAMS[activeUser.color].name} Strategist</p>
                    </div>

                    {!isLocked && (
                        <div className="flex gap-2 mb-10">
                            <input className="flex-1 bg-zinc-900 border border-zinc-800 p-4 rounded-xl outline-none font-bold text-xs uppercase" placeholder="NEW PREDICTION..." value={predInput} onChange={e => setPredInput(e.target.value)} />
                            <button onClick={() => { if(!predInput) return; const nl = participants.map(u => u.id === activeUser.id ? {...u, predictions: [...u.predictions, {id: Date.now(), text: predInput, done: false}]} : u); updateDB(nl, isLocked); setActiveUser(nl.find(x => x.id === activeUser.id)); setPredInput(''); }} className="f1-bg-red px-6 rounded-xl font-black text-[10px]">ADD</button>
                        </div>
                    )}

                    <div className="space-y-3">
                        {activeUser.predictions.map(pr => (
                            <div key={pr.id} className="f1-glass p-5 rounded-2xl flex items-center justify-between group">
                                <div className="flex items-center gap-6 cursor-pointer flex-1" onClick={() => { const nl = participants.map(u => u.id === activeUser.id ? {...u, predictions: u.predictions.map(x => x.id === pr.id ? {...x, done: !x.done} : x)} : u); updateDB(nl, isLocked); setActiveUser(nl.find(x => x.id === activeUser.id)); }}>
                                    <div className={`w-5 h-5 rounded flex items-center justify-center border-2 ${pr.done ? 'bg-green-500 border-green-500' : 'border-zinc-700'}`}>{pr.done && <span className="text-black font-black text-[10px]">‚úì</span>}</div>
                                    <span className={`text-sm font-black italic uppercase ${pr.done ? 'opacity-20 line-through' : ''}`}>{pr.text}</span>
                                </div>
                                {!isLocked && <button onClick={() => { const nl = participants.map(u => u.id === activeUser.id ? {...u, predictions: u.predictions.filter(x => x.id !== pr.id)} : u); updateDB(nl, isLocked); setActiveUser(nl.find(x => x.id === activeUser.id)); }} className="text-red-500 text-xs">‚úï</button>}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
